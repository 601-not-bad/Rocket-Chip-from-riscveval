<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>RISC-V VHDL: System-on-Chip: SW Debugger (C++)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">RISC-V VHDL: System-on-Chip
   &#160;<span id="projectnumber">2.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Design&#160;Unit&#160;List</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">SW Debugger (C++) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><dl class="section user"><dt>Overview</dt><dd>This debugger was specially developed as a software utility to interact with our SOC implementation in <code><a class="el" href="classrocket__soc.html" title="SOC Top-level entity declaration. ">rocket_soc</a></code> repository. The main purpose was to provide convinient way to develop and debug our Satellite Navigation firmware that can not be debugged by any other tool provided RISC-V community (for now). Debugger provides base functionality such as read/write memory and CSR registers, reloading FW image and reset target. Also we are developing own version of the CPU simulator (analog of <code>spike</code>) and Full SOC simulators. These extensions for the debugger simplify porting procedure of the Operating System (Zephyr project) so that simulation doesn't require any hardware and allow to see CPU registers on each step and logging them into file.</dd></dl>
<h1><a class="anchor" id="dbg_1"></a>
Project structure</h1>
<p>General idea of the project is to develop one <code>Core</code> library providing API methods for registering <code>classes</code>, <code>services</code>, <code>attributes</code> and methods to interact with them. Each extension plugin registers one or several class services performing some usefull work. All plugins are built as an independent libraries that are opening by  library at initialization stage with the call of method <b>plugin_init()</b>. All Core API methods start with <code>RISCV_</code>... prefix: </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> RISCV_register_class(IFace *icls);</div>
<div class="line"></div>
<div class="line">IFace *RISCV_create_service(IFace *iclass, <span class="keyword">const</span> <span class="keywordtype">char</span> *name, </div>
<div class="line">                            AttributeType *args);</div>
<div class="line"></div>
<div class="line">IFace *RISCV_get_service(<span class="keyword">const</span> <span class="keywordtype">char</span> *name);</div>
<div class="line">...</div>
</div><!-- fragment --><p>Configuration of the debugger and plugins is fully described in JSON formatted configuraiton file <b>config.json</b>. This file stores all instantiated services names, attributes values and interconnect among plugins. This configuration can be saved to/load from file at any time. By default command <code>exit</code> will save current debugger state into file (including full command history).</p>
<dl class="section note"><dt>Note</dt><dd>You can manually add/change new CSR registers names and indexes by modifying this config file without changing source code. If you accidently corrupt the JSON format you can return default setting by starting debugger with <code>-nocfg</code> key.</dd></dl>
<dl class="section user"><dt>Folders description</dt><dd><ol type="1">
<li><b>libdgb64g</b> - Core library (so/dll) that provides standard API methods defined in file <code><a class="el" href="api__core_8h.html" title="Core API methods declaration. ">api_core.h</a></code>.</li>
<li><b>appdbg64g</b> - Executable (exe) file implements functionality of the console debugger.</li>
<li><em>Plugins:</em> <ol type="a">
<li><b>simple_plugin</b> - Simple plugin (so/dll library) just for demonstration of the integration with debugger.</li>
<li><b>cpu_fnc_plugin</b> - Functional model of the RISC-V CPU (so/dll library).</li>
<li><b>socsim_plugin</b> - Functional models of the peripheries and assembled board (so/dll library). This plugin registers several classes: <code>UART</code>, <code>GPIO</code>, <code>SRAM</code>, <code>ROMs</code> and etc.</li>
</ol>
</li>
</ol>
</dd></dl>
<h1><a class="anchor" id="dbg_target"></a>
Debug Target</h1>
<p>We provide two targets that can run your software (bootloader, firmware or user application) without modifications:</p><ol type="1">
<li>Platform simulator. Use it if you haven't ML605 or KC705 FPGA boards that are used in our developemnt porjects or just for fun.</li>
<li>FPGA boards. We provide bit-files for ML605 (Virtex6) and KC705 (Kintex7) boards that can be used without synthesis procedure.</li>
</ol>
<h2><a class="anchor" id="dbg_sim"></a>
Debug SOC simulator</h2>
<p>To run simulation board that reproduce behaviour of the full system (GPIO, UART, GNSS engine etc) it is enough to start debugger executable file with key <b> -sim </b>.</p>
<pre class="fragment">bin/release/appdbg64g.exe -sim  </pre><p>In this case common structure will be look as follow:</p>
<div class="image">
<img src="pics/dbg_sim.png"  alt="sim debug"/>
</div>
<p>If you'll get the error messages that image files not found</p>
<div class="image">
<img src="pics/dbg_err1.png"  alt="File not found"/>
</div>
<p>To fix this problem do the following steps:</p><ol type="1">
<li>Close debugger console using <code>exit</code> command.</li>
<li>Open <em>config.json</em> file in any editor.</li>
<li>Find strings that specify these paths and correct them. Simulator uses the same images as VHDL platform for ROMs intialization. You can find them in <em>'rocket_soc/fw_images'</em> directory. After that you should see something like follow:</li>
</ol>
<div class="image">
<img src="pics/dbg_simout1.png"  alt="Simulator output"/>
</div>
<p>Debug your target. All commands that are available for Real Hardware absolutely valid for the Simulation. Debugger doesn't see any difference between these two targets.</p>
<dl class="section note"><dt>Note</dt><dd>We redirect all output streams of the simulated platform into debugger console but we are going to implement independent GUI for simulated platform with its own UART/GPIO or Ethernet outputs and serial console window.</dd></dl>
<h2><a class="anchor" id="dbg_hw"></a>
Debug Real Hardware</h2>
<p>Before you start pass through the following checklist:</p><ol type="1">
<li>You should properly <a class="el" href="eth_link.html">setup network connection </a> and see FPGA board in ARP-table.</li>
<li>If you've changed default FPGA IP address:<ol type="a">
<li>Open <em>config.json</em></li>
<li>Change value <b>['BoardIP','192.168.0.51']</b> on your one.</li>
</ol>
</li>
<li>Run debugger</li>
</ol>
<pre class="fragment">bin/release/appdbg64g.exe </pre><p>In this case connection scheme with FPGA board looks as follow:</p>
<div class="image">
<img src="pics/dbg_fpga.png"  alt="fpga debug"/>
</div>
<p>Example of debugging session (Switch ON all User LEDs on board): </p><div class="fragment"><div class="line">riscv# csr MCPUID               -- Read supported ISA extensions</div>
<div class="line">riscv# read 0xfffff000 20       -- Read 20 bytes from PNP module</div>
<div class="line">riscv# csr MRESET 1             -- Raise CPU reset signal</div>
<div class="line">riscv# write 0x80000000 4 0xff  -- Write into GPIO <span class="keyword">new</span> LED value</div>
<div class="line">riscv# loadelf helloworld       -- Load elf-file to board RAM and run</div>
</div><!-- fragment --><p>Debugger console view</p>
<div class="image">
<img src="pics/dbg_testhw.png"  alt="HW debug example"/>
</div>
<p>FPGA serial console output:</p>
<div class="image">
<img src="pics/dbg_testhw2.png"  alt="Serial output"/>
</div>
 </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.10
</small></address>
</body>
</html>
