<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>RISC-V VHDL: System-on-Chip: Ethernet setup</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="fixed_styles.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">RISC-V VHDL: System-on-Chip
   &#160;<span id="projectnumber">2.0</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('eth_link.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Ethernet setup </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><dl class="section user"><dt>Overview</dt><dd>The Ethernet Media Access Controller (GRETH) provides an interface between an AMBA-AXI bus and Ethernet network. It supports 10/100 Mbit speed in both full- and half-duplex modes. Integrated EDCL submodule implements hardware decoding of UDP traffic and redirects EDCL request directly on AXI system bus. The AMBA interface consists of an AXI slave interface for configuration and control and an AXI master interface for transmit and receive data. There is one DMA engine for the transmitter and one for receiver. EDCL submodule and both DMA engines share the same AXI master interface.</dd></dl>
<p>To make development board visible in your local network your should properly specify connection properties. In this chapter I will show how to configure the host computer (Windows 7 or Linux) to communicate with the FPGA hardware over Ethernet.</p>
<dl class="section note"><dt>Note</dt><dd><em>If you also want simultaneous Internet access your host computer requires a second Ethernet port. I couldn't find workable configuration via router.</em></dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>I recommend you to make restore point before you start.</dd></dl>
<h1><a class="anchor" id="eth_cfgwin"></a>
Configure Windows Host</h1>
<p>Let's setup the following network configuration that allows to work with FPGA board and to be connected to Internet. I use different Ethernet ports and different subnets (192.168.0.x and 192.168.1.x accordingly).</p>
<div class="image">
<img src="pics/eth_common.png" alt="Ethernet config"/>
</div>
 <dl class="section user"><dt>Host IP and subnet definition:</dt><dd><ol type="1">
<li>Open <code>cmd</code> console.</li>
<li>Use <code>ipconfig</code> command to determine network settings. <pre class="fragment">    ipconfig /all</pre></li>
<li>Find your IP address (in my case it's 192.168.1.4)</li>
<li>Check and change if needed default IP address of SOC as follow.</li>
</ol>
</dd></dl>
<dl class="section user"><dt>Setup hard-reset FPGA IP address:</dt><dd><ol type="1">
<li>Open in editor <em>rocket_soc.vhd</em>.</li>
<li>Find place where <em>grethaxi</em> module is instantiated.</li>
<li>Change generic <b>ipaddrh</b> and <b>ipaddrl</b> parameters so that they belonged another subnet (Default values: C0A8.0033 corresponding to 192.168.0.51) than Internet connection.</li>
</ol>
</dd></dl>
<dl class="section user"><dt>Configure the Ethernet card for your FPGA hardware</dt><dd><ol type="1">
<li>Load pre-built image file into FPGA board (located in <em>./rocket_soc/bit_files/</em> folder) or use your own one.<br />
</li>
<li>Open <b>Network and Sharing Center</b> via Control Panel</li>
</ol>
</dd></dl>
<div class="image">
<img src="pics/eth_win1.png" alt="ControlPanel"/>
</div>
  <pre class="fragment">-# Click on &lt;b&gt;Local Area Connection 2&lt;/b&gt; link
</pre><div class="image">
<img src="pics/eth_win2.png" alt="ControlPanel"/>
</div>
  <pre class="fragment">-# Click on &lt;b&gt;Properties&lt;/b&gt; to open properties dialog.
</pre><div class="image">
<img src="pics/eth_win3.png" alt="ControlPanel"/>
</div>
  <pre class="fragment">-# Disable all network services except &lt;b&gt;Internet Protocol Version 4&lt;/b&gt;
</pre><p> as shown on figure above.<br />
</p><ol type="1">
<li>Select enabled service and click on <b>Properties</b> button.</li>
</ol>
<div class="image">
<img src="pics/eth_win4.png" alt="ControlPanel"/>
</div>
  <pre class="fragment">-# Specify unique IP as shown above so that FPGA and your Local
</pre><p> Connection were placed <b>in the same subnet</b>.<br />
</p><ol type="1">
<li>Leave the subnet mask set to the default value 255.255.255.0.<br />
</li>
<li>Click OK.</li>
</ol>
<dl class="section user"><dt>Check connection</dt><dd><ol type="1">
<li>Check presence of the Ethernet activity by blinking LEDs near the Ethernet connector on FPGA board</li>
<li>Run <code>arp</code> command to see arp table entries. <pre class="fragment">    arp -a -v</pre></li>
</ol>
</dd></dl>
<div class="image">
<img src="pics/eth_check1.png" alt="Check arp"/>
</div>
  <pre class="fragment">-# MAC supports only ARP and EDCL requests on hardware level and it cannot
</pre><p> respond on others without properly installed software. By this reason ping won't work without running OS on FPGA target but it maybe usefull to ping FPGA target so that it can force updating of the ARP table or use the commands: </p><pre class="fragment">    ipconfig /release
    ipconfig /renew</pre><h1><a class="anchor" id="eth_cfglin"></a>
Configure Linux Host</h1>
<p>Let's setup the similar network configuration on Linux host.</p><ol type="1">
<li>Check <b>ipaddrh</b> and <b>ipaddrl</b> values that are hardcoded on top-level of SOC (default values: C0A8.0033 corresponding to 192.168.0.51).</li>
<li>Set host IP value in the same subnet using the <code>ifconfig</code> command. You might need to enter a password to use the <code>sudo</code> command. <pre class="fragment">      % sudo ifconfig eth0 192.168.0.53 netmask 255.255.255.0 </pre></li>
<li>Enter the following command in the shell to check that the changes took effect: <pre class="fragment">      % ifconfig eth0</pre></li>
</ol>
<h1><a class="anchor" id="eth_appl"></a>
Run Application</h1>
<p>Now your FPGA board is ready to interact with the host computer via Ethernet. You can find detailed information about MAC (GRETH) in <a href="http://gaisler.com/products/grlib/grip.pdf">GRLIB IP Core User's Manual</a>.</p>
<p>There you can find:</p><ol type="1">
<li>DMA Configuration registers description (Rx/Tx Descriptors tables and entries).</li>
<li>EDCL message format.</li>
<li><code>GRLIB</code> itself includes C-example that configure MAC Rx/Tx queues and start transmission of the 1500 Mbyte of data to define Bitrate in Mbps.</li>
</ol>
<p>We provide debugger functionality via Ethernet. See <a class="el" href="">Debugger description </a> page. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
